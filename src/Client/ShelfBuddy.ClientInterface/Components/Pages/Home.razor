@page "/"
@using ShelfBuddy.ClientInterface.Services
@inject IUserService UserService
@inject NavigationManager NavigationManager
@inject IInventoryStateService InventoryStateService
@inject IPreferences Preferences

<PageTitle>ShelfBuddy</PageTitle>

<div class="home-container">
    @if (_isLoading)
    {
        <div class="loading-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p>Loading your inventory data...</p>
        </div>
    }
</div>

@code {
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var isAuthenticated = await UserService.IsAuthenticatedAsync();

        if (!isAuthenticated)
        {
            _isLoading = false;
            NavigationManager.NavigateTo("/login");
            return;
        }

        var user = await UserService.GetCurrentUserAsync();
        if (user is null)
        {
            _isLoading = false;
            NavigationManager.NavigateTo("/login");
            return;
        }
        
        try
        {
            await InventoryStateService.InitializeAsync(user.Id);
        }
        finally
        {
            _isLoading = false;
        }

        NavigationManager.NavigateTo("/inventory/current");

        // if (InventoryStateService.HasActiveInventory && 
        //     InventoryStateService.CurrentInventory?.Id is not null)
        // {
        //     NavigationManager.NavigateTo($"/inventory/{InventoryStateService.CurrentInventory.Id}");
        //     return;
        // }
        
        // NavigationManager.NavigateTo("/inventories");
    }
}